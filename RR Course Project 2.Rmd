---
title: "Module 5: Reproducible Research - Course Project 2"
author: "Roddy Mendoza Marriott"
date: "2025-06-19"
output:
  html_document: default
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## 1.Introduction

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

## 2.Data

The data for this assignment come in the form of a comma-separated-value file compressed via the bzip2 algorithm to reduce its size. You can download the file from the course web site:

[Storm Data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2)

There is also some documentation of the database available. Here you will find how some of the variables are constructed/defined.

[National Weather Service Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

[National Climatic Data Center Storm Events](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf)

The events in the database start in the year 1950 and end in November 2011. In the earlier years of the database there are generally fewer events recorded, most likely due to a lack of good records. More recent years should be considered more complete.


## 3.Questions to be answered 

The data analysis must address the following questions:

1. Across the United States, which types of events (as indicated in the EVTYPEEVTYPEstart color red, start verbatim, EVTYPE, end verbatim, end color red variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?


## 4.Loading libraries
```{r, message=FALSE,warning=FALSE}
library(ggplot2)
library(tidyverse)
library(rmarkdown)
library(magrittr)
library(kableExtra)
library(DT)
```


## 5.Getting the data
## 5.1 Creating a data directory

```{r, message=FALSE,warning=FALSE}
# 1. Create a data directory
if(!base::file.exists("data")) {
    base::dir.create("data")
}

# 2. Download files and store it in data directory.
if(!base::file.exists("./data/repdata_data_StormData.csv.bz2")){
    utils::download.file(url = "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2",
                         destfile = "./data/repdata_data_StormData.csv.bz2")
}
```


## 5.2 Loading the data

```{r, message=FALSE,warning=FALSE}
# 1. the raw data
raw_data <- utils::read.csv(file = "./data/repdata_data_StormData.csv.bz2")
```

```{r, message=FALSE,warning=FALSE}
# 2. converting into a data frame 
raw_data <- dplyr::tbl_df(raw_data)
```


## 6 Some EDA on the data

This section presents a few remarks in the EDA on the data from NOAA.

## 6.1 Dimensions 

```{r, message=FALSE,warning=FALSE}
base::dim(raw_data)
```

## 6.2 Head and Tail

Printing the first 5 rows from dataset

```{r, message=FALSE,warning=FALSE}
# printing the first 5 rows from raw data
head(raw_data,5)
```


Printing the last 5 rows from dataset

```{r, message=FALSE,warning=FALSE}
# printing the last 5 rows from raw data
tail(raw_data,5)
```


## 6.3 Variables

The dataset from NOAA has 37 variables, as wee seen using the `str` function

```{r, message=FALSE,warning=FALSE}
utils::str(raw_data)
```

## 6.3 `NA` Presence

```{r, message=FALSE,warning=FALSE}
# Printing the summ of LATITUDE
summary(raw_data$LATITUDE)
```

```{r, message=FALSE,warning=FALSE}
# Printing the summ of Latitude_e
summary(raw_data$LATITUDE_E)
```


## 6.4 Exponential variables´s treatment

The `PROPDMGEXP` and `CROPDMGEXP`(Properties Exponential and Crop Exponential) variables store the base 10 exponential value of `PROPDMG` and `CROPDMG`,
respectively. For this reason, it is necessary to combine `PROPDMG` and `PROPDMGEXP` into a single variable and do the same to `CROPDMG` and `CROPDMGEXP`

Therefore, it is essential to understand how the `PROPDMGEXP` and `CROPDMGEXP` were recorded.


```{r, message=FALSE,warning=FALSE}
# Printing the unique values to exponential to properties
unique(raw_data$PROPDMGEXP)
```

```{r, message=FALSE,warning=FALSE}
# Printing the unique values to exponential to Crops.
unique(raw_data$CROPDMGEXP)
```

Finally, the notation is not uniform because sometimes they use Capital or Lowercase (e.g., `K` or `k`). In other cases, they use a number or insert a question mark (`?`) or plus/minus signal (e.g., `-` or `+`).

*`PROPDMGEXP`

  + `?`: Has 8 (eight) observations with this notation, none of the rows of `PROPDM` and `CROPDMG` has values;
  + `+`: Has 5 (five) observations with this notation, and;
  + `-`: Has 1 (one) observation with this notation and 1 (one) fatality. I will consider like “0”.


*`CROPDMGEXP`

  + `?`: Has 7 (seven) observations with this notation, all those with `CROPDMG` as zero;


## 6.5 Grouping data by `Event type`

The raw dataset has 985 Event Types, the code below will present the first 10.


```{r, message=FALSE,warning=FALSE}
raw_data %>%
    group_by(EVTYPE) %>%
    summarise(n = n()) %>%
    arrange(desc(n)) %>%
    head(10)
```


## 7 Working on the data

There are some troubles working on these date variables: `BGN_DATE`, `END_DATE`,
and `END_TIME`, helpfully we are not using these variables as a part of the
course project.

Keeping up with the main goal of this project, the dataset will be subsetted as
follows:


## 7.1 Subsseting the raw data

As we move on the project, we are looking for the most harmful events concerning
in: population health and the economic consequences (loses in USD american dollars).

In that order, the data that will be subsetted from the `raw_data` will be:

*`Variables:`

  +`EVTYPE`: Event type;
    
  +`INJURIES`: Quantity of injuries;
    
  +`FATALITIES`: Quantity of fatalities;
    
  +`PROPDMG`:  Amount in USD american dollars in Damages in properties;
    
  +`CROPDMG`:  Amount in USD american dollars in Damages in crops;
    
  +`PROPDMGEXP`: he exponential in base 10 used to notate the PROPDMG;
    
  +`CROPDMGEXP`: The exponential in base 10 used to notate the CROPDMG
  
  

```{r, message=FALSE,warning=FALSE}
# Subsetting the dataset
df_subset <- select(raw_data,EVTYPE,INJURIES,FATALITIES,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP)
```



## 7.2 Merging damage and exponential variables

It is necessary to merge `PROPDMG` and `PROPDMGEXP` into a single variable, so I will create the `PROPDMGABS` using the following rules.

*`Adjusted variables:`

  +All `0`, and `-` will be converted into 1;
  
  +All `1` will be converted into 10;
  
  +All `H`, `h` and `2` will be converted into 100;
  
  +All `K`, `k` and `3` will be converted into 1000;
  
  +All `4` will be converted into 10000;
  
  +All `5` will be converted into 100000;
  
  +All `M`, `m` and `6` will be converted into 1000000;
  
  +All `7` will be converted into 10000000;
  
  +All `8` will be converted into 100000000;
  
  +All `B`, `b` and `9` will be converted into 1000000000;

Following the same principles, I will merge `CROPDMG` and `CROPDMG` to create `CROPDMGABS`:


*`Adjusted variables:`

  +All `0`, and `?` will be converted into 1;
  
  +All `H`,`h` and `2` will be converted into 100;
  
  +All `K`, `k` and `3` will be converted into 1000;
  
  +All `M`, `m` and `6` will be converted into 1000000;
  
  +All `B`, `b` and `9` will be converted into 1000000000
  
  
The `PROPDMGABS` and `CROPDMGABS` will be in charge of storing the absolute values of Properties Damages and Crops Damages.


```{r, message=FALSE,warning=FALSE}
# Merging exponential column and value column.
df_subset_2 <- df_subset %>%
  # Creating a new column PROPDMGABS
    mutate(PROPDMGABS = case_when(
        PROPDMGEXP %in% c("", "-",0) ~ PROPDMG * 1,
        PROPDMGEXP %in% c(1)         ~ PROPDMG * 10,
        PROPDMGEXP %in% c("H","h",2) ~ PROPDMG * 100,
        PROPDMGEXP %in% c("K","k",3) ~ PROPDMG * 1000,
        PROPDMGEXP %in% c(4)         ~ PROPDMG * 10000,
        PROPDMGEXP %in% c(5)         ~ PROPDMG * 100000,
        PROPDMGEXP %in% c("M","m",6) ~ PROPDMG * 1000000,
        PROPDMGEXP %in% c(7)         ~ PROPDMG * 10000000,
        PROPDMGEXP %in% c(8)         ~ PROPDMG * 100000000,
        PROPDMGEXP %in% c("B","b",9) ~ PROPDMG * 1000000000)) %>%

# Creating a new column CROPDMGABS
    mutate(CROPDMGABS = case_when(
        CROPDMGEXP %in% c("?","", 0)   ~ CROPDMG * 1,
        CROPDMGEXP %in% c("H", "h", 2) ~ CROPDMG * 100,
        CROPDMGEXP %in% c("K", "k", 3) ~ CROPDMG * 1000,
        CROPDMGEXP %in% c("M", "m", 6) ~ CROPDMG * 1000000,
        CROPDMGEXP %in% c("B", "b", 9) ~ CROPDMG * 1000000000)) 


```















